{% extends "base.twig" %}

{% block title %}
    {{ form.title }}
{% endblock %}

{% block content %}

    <div class="container">
        <div class="page-header">
            <h1>{{ form.title }}</h1>
        </div>

        {% if form.description is not empty %}
            <blockquote>
                <span>{{ form.description|raw }}</span>
            </blockquote>
        {% endif %}

        <form class="col-lg-12 col-md-12 col-sm-12 col-xs-12" method="post" id="pageForm">
            <ul>
                {% for object in objects %}

                    {% if object.type != 'label' %}

                        {% if object.required == '1' %}
                            <label for="{{ object.type }}_{{ object.ID }}">{{ object.caption }} <span
                                        style="color:red;">*</span></label>
                        {% else %}
                            <label for="{{ object.type }}_{{ object.ID }}">{{ object.caption }}</label>
                        {% endif %}

                    {% endif %}

                    {% include "objects/#{object.type}.twig" %}

                    {% if form.developer_mode == '1' %}
                        <code>@@{{ object.type }}_{{ object.ID }}</code>
                        <br>
                    {% endif %}

                    </br>
                {% endfor %}
            </ul>
        </form>
    </div>

{% endblock %}

{% block js %}
    <script>
        // Attach a submit handler to the form
        $("#pageForm").submit(function (event) {

            // Stop form from submitting normally
            event.preventDefault();

            $('#submitButton').prop('disabled', true).text("Working...");

            // Send the data using post
            var posting = $.post("{{ path_for('formInsert', {'sql': form.submit_statement|url_encode}) }}", $(this).serialize());

            // Show the results
            posting.done(function (data) {
                console.log(data);

                if (!data.success) {
                    $('#submitButton').prop('disabled', false);
                    swal({
                        title: data.msgTitle,
                        text: data.msgBody,
                        type: "warning",
                        showConfirmButton: true
                    });
                } else {
                    swal({
                            title: data.msgTitle,
                            text: data.msgBody,
                            type: "success",
                            showConfirmButton: true
                        },
                        function () {
                            location.reload();
                        });
                }
            });


//            posting.done(function (data) {
//                console.log(data);
//                if (data.msg) {
//                    swal({
//                            title: "Something went wrong!",
//                            text: data.msg,
//                            type: "error"
//                        },
//                        function () {
//                            //location.reload();
//                        });
//                } else {
//                    swal({
//                            title: "Success!",
//                            text: "Thanks! Your form has been submitted successfully.",
//                            type: "success"
//                        },
//                        function () {
//                            location.reload();
//                        });
//                }
//            });
        });
    </script>
{% endblock %}

